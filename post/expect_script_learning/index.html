<!DOCTYPE html>
<html lang="en" dir="ltr" class="scroll-smooth" data-default-appearance="light"
  data-auto-appearance="true"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Learning Expect Programming &middot; Blowfish</title>
  <meta name="title" content="Learning Expect Programming &middot; Blowfish" />
  
  
  <meta name="keywords" content="Expect, Regex, " />
  
  
  <link rel="canonical" href="//localhost:1313/post/expect_script_learning/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.efe989cd11095eee5e026173915472c128b61ba8a106c22ead46741ec9255e7625dba193c53b8bb6fa5ea365248d4750e345dd71654234bdb04eadc42de91f30.css"
    integrity="sha512-7&#43;mJzREJXu5eAmFzkVRywSi2G6ihBsIurUZ0HsklXnYl26GTxTuLtvpeo2UkjUdQ40XdcWVCNL2wTq3ELekfMA==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.5200170cb3ed0adabce28870bf7ff061203bbefb075c90b7b76cc561cd376288fbd116092bd2e65b027908506b03f8fd15b5613608229bdc92f93ecf6d8faa64.js"
    integrity="sha512-UgAXDLPtCtq84ohwv3/wYSA7vvsHXJC3t2zFYc03Yoj70RYJK9LmWwJ5CFBrA/j9FbVhNggim9yS&#43;T7PbY&#43;qZA==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Learning Expect Programming" />
<meta property="og:description" content="In 
    my previous post,
I talked about how to automate the server login process with the help of Expect
programming language. This post continues my learning process." />
<meta property="og:type" content="article" />
<meta property="og:url" content="//localhost:1313/post/expect_script_learning/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-10-29T01:42:59+08:00" />
<meta property="article:modified_time" content="2019-10-29T01:42:59+08:00" />


  <meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Learning Expect Programming"/>
<meta name="twitter:description" content="In 
    my previous post,
I talked about how to automate the server login process with the help of Expect
programming language. This post continues my learning process."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Learning Expect Programming",
    "headline": "Learning Expect Programming",
    
    "abstract": "\u003cp\u003eIn \u003ca href=\u0022https:\/\/jdhao.github.io\/2018\/10\/08\/server_autologin_with_expect\/\u0022   target=\u0022_blank\u0022\u003e\n    my previous post\u003c\/a\u003e,\nI talked about how to automate the server login process with the help of Expect\nprogramming language. This post continues my learning process.\u003c\/p\u003e",
    "inLanguage": "en",
    "url" : "\/\/localhost:1313\/post\/expect_script_learning\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2019",
    "dateCreated": "2019-10-29T01:42:59\u002b08:00",
    "datePublished": "2019-10-29T01:42:59\u002b08:00",
    
    "dateModified": "2019-10-29T01:42:59\u002b08:00",
    
    "keywords": ["Expect","Regex"],
    
    "mainEntityOfPage": "true",
    "wordCount": "988"
  }]
  </script>


  
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  

  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">Blowfish</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <p class="text-base font-medium" title="About">
        About
    </p>
</a>


            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                    
  <li class="mt-1">
    <a href="/about/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="About">
            About
        </p>
    </a>
</li>



                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>





  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Learning Expect Programming
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  













<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2019-10-29 01:42:59 &#43;0800 &#43;0800">29 October 2019</time><span class="px-2 text-primary-500">&middot;</span><span>988 words</span><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">5 mins</span>
  

  
  
</div>







    </div>

    
    
    
    
    

    
      
      
<div class="flex author">
  
  <div class="place-self-center">
    
    
    <div class="text-2xl sm:text-lg">
</div>
  </div>
</div>
    

    

    

    
    <div class="mb-5"></div>
    
  
  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
    

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          <p>In <a href="https://jdhao.github.io/2018/10/08/server_autologin_with_expect/"   target="_blank">
    my previous post</a>,
I talked about how to automate the server login process with the help of Expect
programming language. This post continues my learning process.</p>
<h1 class="relative group">Difference between <code>send</code> and <code>send_user</code> command? 
    <div id="difference-between-send-and-send_user-command" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#difference-between-send-and-send_user-command" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>There are two similar commands in Expect, <code>send</code> and <code>send_user</code>. <code>send</code> and
<code>send_user</code> have different purposes. <code>send</code> is used to provide input for the
spawned processes, while <code>send_user</code> is used to send some message to via
terminal to the users.</p>


<h1 class="relative group">Difference between <code>\n</code> and <code>\r</code> in Expect? 
    <div id="difference-between-n-and-r-in-expect" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#difference-between-n-and-r-in-expect" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>According to my test, when you use <code>send</code> to send characters to the spawned
process, it makes no difference to use either <code>\r</code> (carriage return) or <code>\n</code>
(line feed). They both works as if the user has press the <kbd>Enter</kbd> key.</p>
<p>However, they work differently when you want use <code>send_user</code> to display
something to the user. <code>\n</code> will give a new line while <code>\r</code> will just move the
cursor to the beginning of the line (i.e., your message will be erased). To
verify, execute the following command</p>
<pre tabindex="0"><code class="language-expect" data-lang="expect">expect {
    &#34;prompt1&#34; {send_user &#34;answer1\n&#34;}
    &#34;prompt2&#34; {send_user &#34;answer2\r&#34;}
}
</code></pre><p>If you execute the above script with expect, when you input <code>prompt1</code>, you will
get the output <code>answer1</code> and a new line is started; when you input <code>prompt2</code>,
you get nothing in the screen. Actually, <code>answer2</code> is shown and is then erased
by <code>\r</code>.</p>


<h1 class="relative group">Check if a file exists 
    <div id="check-if-a-file-exists" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#check-if-a-file-exists" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Sometimes, we may want to check if a file exists and take some actions based on
the condition. We use <a href="http://tcl.tk/man/tcl8.5/TclCmd/file.htm#M15"   target="_blank">
    <code>file exists &lt;name&gt;</code></a> to check that:</p>
<pre tabindex="0"><code class="language-expect" data-lang="expect">if {[file exists .ssh/known_hosts]} {
    spawn rm .ssh/known_hosts
}
</code></pre>

<h1 class="relative group">Match optional prompts 
    <div id="match-optional-prompts" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#match-optional-prompts" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<p>Sometimes, there are optional prompts which may occur depending on some
conditions. For example, when we first log into a new server, we are warned
that the authenticity of the server can not be established and if we want to
continue connecting. After that, we may not see this prompt anymore. We can use
the <code>exp_continue</code> command to achieve that.</p>
<pre tabindex="0"><code class="language-expect" data-lang="expect">expect {
    &#34;Are you sure*&#34; {
        send &#34;yes\r&#34;
        exp_continue
    }
    &#34;*password: &#34; {
        send &#34;pass\r&#34;
    }
}
</code></pre><p>The <code>exp_continue</code> command will continue the expect block until it matches
another pattern or timeouts.</p>


<h1 class="relative group">Pattern matching 
    <div id="pattern-matching" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#pattern-matching" aria-label="Anchor">#</a>
    </span>        
    
</h1>


<h2 class="relative group">Double quotes and curly braces in pattern matching 
    <div id="double-quotes-and-curly-braces-in-pattern-matching" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#double-quotes-and-curly-braces-in-pattern-matching" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>In expect script, both double quotes and curly braces can be used to group
argument. They are quite different.</p>
<p>Inside double quotes, variable substitution and command substitution and
backslash substitution take place:</p>
<ul>
<li>variable substitution: <code>$var</code> will be replaced with actual value of variable <code>var</code>.</li>
<li>command substitution: <code>[some_char]</code> is considered as command invoking, and
he result of executing command <code>some_char</code> replaces <code>[some_char]</code>. Also see
<a href="https://www.tcl.tk/man/tcl8.5/tutorial/Tcl5.html"   target="_blank">
    this guide page.</a></li>
<li>backslash substitution: characters after <code>\</code> is replaced with the character
verbatim. There are several exceptions to this rule. For example, <code>\n</code>, <code>\t</code>,
<code>\uHHHH</code> etc. have special meanings. For a complete list, see <a href="https://wiki.tcl-lang.org/page/Dodekalogue"   target="_blank">
    this
page</a> (the part about backslash
substitution).</li>
</ul>
<p>Inside double braces, command substitution, variable expansion and backslash
substitution does not take place.  For example:</p>
<pre tabindex="0"><code>expect {
    # match $var literally
    {$var} {send_user &#34;yes\n&#34;}
    # match character \ and $
    {\$} {send_user &#34;yes\n&#34;}
    # match character \ and n
    {\n} {send_user &#34;yes\n&#34;}
}
</code></pre>

<h2 class="relative group">Glob match patterns 
    <div id="glob-match-patterns" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#glob-match-patterns" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>For simple matching, glob patterns can be used, and it works similarly to the
bash glob functionality. <code>*</code> is used to represent any number of characters, and
<code>?</code> is used to represent a single character. For more info about glob patterns,
see <a href="https://www.tcl.tk/man/tcl8.5/tutorial/Tcl16a.html"   target="_blank">
    doc here</a>.</p>
<p>Some patterns and their meanings are listed below:</p>
<pre tabindex="0"><code>expect{
    # match strings containing abc
    expect *abc*
    # match literal [a]
    {\[a]} {send_user &#34;yes\n&#34;}
    # match literal [a]
    {\[a\]} {send_user &#34;yes\n&#34;}
    # match strings containing ab followed by another character
    {ab?} {send_user &#34;yes\n&#34;}
    # match `abc` or `abd`
    {ab[cd]} {send_user &#34;yes\n&#34;}
}
</code></pre>

<h2 class="relative group">Regex matching 
    <div id="regex-matching" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#regex-matching" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>If you want to match more complex patterns, you can also use the <a href="http://www.tcl.tk/man/tcl8.5/TclCmd/re_syntax.htm#M66"   target="_blank">
    regex
provided by the Tcl
language</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. To use
regex, you will use the <code>-re</code> option for <code>expect</code> command. For example, to
match either <code>ab</code> or <code>cd</code>, you can use the following command:</p>
<pre tabindex="0"><code>expect -re ab|cd {send_user &#34;hello\n&#34;}
</code></pre><p>As discussed before, since patterns inside the double quotes undergo several
substitutions, you should take extra care when you want to match patterns using
regex. For example, to match consecutive digits, you should use <code>expect -re &quot;\\d+&quot;</code> or <code>expect -re {\d+}</code>.  If you use <code>expect -re &quot;\d+&quot;</code>, you will match
consecutive  character<code>d</code> since backslash will translate <code>\d</code> inside double
quotes.</p>
<pre tabindex="0"><code> expect {
    # the following two patterns both match two consecutive alphabet chars.
    -re &#34;\[a-z\]{2}&#34; {send_user &#34;yes\n&#34;}
    -re {[a-z]{2}} {send_user &#34;yes\n&#34;}
    # match a lenth 2 string which contains only alpha-numerical chars.
    -re {^[a-z0-9]{2}\n$} {send_user &#34;yes\n&#34;}
    timeout {send_user &#34;time out\n&#34;}
 }
</code></pre>

<h2 class="relative group">Matching bracket literally 
    <div id="matching-bracket-literally" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#matching-bracket-literally" aria-label="Anchor">#</a>
    </span>        
    
</h2>
<p>One extremely complex and bewildering  pattern is to match square bracket
literally. It is difficult because square bracket have special meanings in both
command substitution and in regex or glob pattern.</p>
<p>If you use double quotes, in order to match <code>[a]</code> literally, you have to use
triple backslash to escape it:</p>
<pre tabindex="0"><code>expect -re &#34;\\\[a\\\]&#34; {send_user &#34;yes\n&#34;}
# or you can use
expect &#34;\\\[a\\\]&#34; {send_user &#34;yes\n&#34;}
</code></pre><p>First backslash is to prevent command substitution. Second backslash and third
backslash is to prevent backslash substitution so that regex engine can see one
backslash.  So the final pattern regex engine sees is actually <code>\[a\]</code>, which
prevents a from being interpreted as a regex range. Thus, it is matched
literally. <a href="https://www.tcl.tk/man/tcl8.5/tutorial/Tcl21.html"   target="_blank">
    This page</a> also
explains why three backslashes are needed  in order to match literal square
bracket if we use double quotes.</p>
<p>To prevent such complex patterns, it is highly encouraged to use double braces
to simplify the pattern. The above pattern can be simplified as the following:</p>
<pre tabindex="0"><code class="language-expect" data-lang="expect">expect {
    {\[a\]} {send_user &#34;yes\n&#34;}
}
</code></pre>

<h1 class="relative group">References 
    <div id="references" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#references" aria-label="Anchor">#</a>
    </span>        
    
</h1>
<ul>
<li><a href="https://stackoverflow.com/questions/23909157/how-to-find-if-a-file-exists-in-expect-script"   target="_blank">
    Expect check if file exists.</a></li>
<li><a href="https://stackoverflow.com/a/52893825/6064933"   target="_blank">
    Expect: match optional prompt.</a></li>
<li><a href="https://stackoverflow.com/a/26187389/6064933"   target="_blank">
    Difference between <code>\r</code> and <code>\n</code> in expect.</a></li>
<li><a href="https://stackoverflow.com/questions/17064555/using-regular-expressions-with-expect"   target="_blank">
    Expect regex</a></li>
<li><a href="https://www.oreilly.com/library/view/exploring-expect/9781565920903/ch04.html"   target="_blank">
    Expect glob and other patterns</a></li>
<li><a href="http://www.tcl.tk/man/tcl8.5/TclCmd/re_syntax.htm#M66"   target="_blank">
    Tcl regex syntax references.</a></li>
<li><a href="https://www.tcl.tk/man/tcl8.5/tutorial/Tcl3.html"   target="_blank">
    Grouping with double quotes.</a></li>
</ul>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>expect language is an extension to the Tcl programming language.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
        </div>
                
        

        

          
      </div>
     
    
     <script>
        var oid = "views_post\/expect_script_learning.md"
        var oid_likes = "likes_post\/expect_script_learning.md"
      </script>
      
      
      
      <script type="text/javascript" src="/js/page.min.5b1bad196a6075a1e11bae1dc95f24f67b610948a00525e347566c5a62338ea78f1c7224ab9a53873dcdb2a1a7d7d391b8a8ef45561297f68806c01315b0c4f6.js" integrity="sha512-WxutGWpgdaHhG64dyV8k9nthCUigBSXjR1ZsWmIzjqePHHIkq5pThz3NsqGn19ORuKjvRVYSl/aIBsATFbDE9g=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/post/ssh_essential_knowledge/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Essential Knowledge about SSH</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-10-27 22:43:12 &#43;0800 &#43;0800">27 October 2019</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/post/pytorch_distributed_training/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Distributed Training in PyTorch with Horovod</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-11-01 22:26:53 &#43;0800 &#43;0800">1 November 2019</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a>
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.62060bb247f4de2b6dde45903668fefb68d792f365587605177b1227c0cf43588701edaca0cb40e2c8e2789bd5ce67c1d2a215b9fb258c3496a7cd25e7cb5fdf.js" integrity="sha512-YgYLskf03itt3kWQNmj&#43;&#43;2jXkvNlWHYFF3sSJ8DPQ1iHAe2soMtA4sjieJvVzmfB0qIVufsljDSWp80l58tf3w=="></script>
  
  
</footer><div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="//localhost:1313/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
