<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>为什么 .bash_profile 里面的设置不生效？ - jdhao's digital space</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="jdhao"><meta name=description content="最近安装了 Neovim，并且在 HOME 目录下的 .bash_profile 中设置好了 Neovim 可执行程序对应的 PATH 变量。奇怪的是，每次在 SSH 客户端打开一个新的服务器连接 session，登录服务器，进入自己账号以后，位于 .bash_profile 中的 PATH 设置命令没有生效，导致我无法启动安装的 Neovim，每次登录以后，我还必须手动 source 一下 .bash_profile 文件，然后才能使用 nvim 命令，非常让人恼火。本文记录我排查问题的过程以及最终的解决方案。
"><meta name=keywords content="Hugo,theme,even"><meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw"><meta name=generator content="Hugo 0.123.8 with theme even"><link rel=canonical href=https://jdhao.github.io/2018/09/06/login_interactive_shell_bash/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="为什么 .bash_profile 里面的设置不生效？"><meta property="og:description" content="最近安装了 Neovim，并且在 HOME 目录下的 .bash_profile 中设置好了 Neovim 可执行程序对应的 PATH 变量。奇怪的是，每次在 SSH 客户端打开一个新的服务器连接 session，登录服务器，进入自己账号以后，位于 .bash_profile 中的 PATH 设置命令没有生效，导致我无法启动安装的 Neovim，每次登录以后，我还必须手动 source 一下 .bash_profile 文件，然后才能使用 nvim 命令，非常让人恼火。本文记录我排查问题的过程以及最终的解决方案。"><meta property="og:type" content="article"><meta property="og:url" content="https://jdhao.github.io/2018/09/06/login_interactive_shell_bash/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-09-06T00:12:53+08:00"><meta property="article:modified_time" content="2021-01-07T16:12:09+01:00"><meta itemprop=name content="为什么 .bash_profile 里面的设置不生效？"><meta itemprop=description content="最近安装了 Neovim，并且在 HOME 目录下的 .bash_profile 中设置好了 Neovim 可执行程序对应的 PATH 变量。奇怪的是，每次在 SSH 客户端打开一个新的服务器连接 session，登录服务器，进入自己账号以后，位于 .bash_profile 中的 PATH 设置命令没有生效，导致我无法启动安装的 Neovim，每次登录以后，我还必须手动 source 一下 .bash_profile 文件，然后才能使用 nvim 命令，非常让人恼火。本文记录我排查问题的过程以及最终的解决方案。"><meta itemprop=datePublished content="2018-09-06T00:12:53+08:00"><meta itemprop=dateModified content="2021-01-07T16:12:09+01:00"><meta itemprop=wordCount content="1120"><meta itemprop=keywords content="shell,Bash,"><meta name=twitter:card content="summary"><meta name=twitter:title content="为什么 .bash_profile 里面的设置不生效？"><meta name=twitter:description content="最近安装了 Neovim，并且在 HOME 目录下的 .bash_profile 中设置好了 Neovim 可执行程序对应的 PATH 变量。奇怪的是，每次在 SSH 客户端打开一个新的服务器连接 session，登录服务器，进入自己账号以后，位于 .bash_profile 中的 PATH 设置命令没有生效，导致我无法启动安装的 Neovim，每次登录以后，我还必须手动 source 一下 .bash_profile 文件，然后才能使用 nvim 命令，非常让人恼火。本文记录我排查问题的过程以及最终的解决方案。"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>jdhao's digital space</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>jdhao's digital space</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>为什么 .bash_profile 里面的设置不生效？</h1><div class=post-meta><span class=post-time>2018-09-06</span><div class=post-category><a href=/categories/Linux/>Linux</a></div><span class=more-meta>1120 words </span><span class=more-meta>3 mins read </span><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#loginnon-login-shell-以及-interactivenon-interactive-shell>login/non-login shell 以及 interactive/non-interactive shell</a></li><li><a href=#哪些配置文件被读取>哪些配置文件被读取？</a></li><li><a href=#参考>参考</a></li></ul></nav></div></div><div class=post-content><p>最近安装了 <a href=https://github.com/neovim/neovim>Neovim</a>，并且在 HOME 目录下的 <code>.bash_profile</code> 中设置好了 Neovim 可执行程序对应的 PATH 变量。奇怪的是，每次在 SSH 客户端打开一个新的服务器连接 session，登录服务器，进入自己账号以后，位于 <code>.bash_profile</code> 中的 PATH 设置命令没有生效，导致我无法启动安装的 Neovim，每次登录以后，我还必须手动 source 一下 <code>.bash_profile</code> 文件，然后才能使用 nvim 命令，非常让人恼火。本文记录我排查问题的过程以及最终的解决方案。</p><p>首先，我尝试把 <code>.bash_profile</code> 里面的设置拷贝到 <code>.bashrc</code> 中，发现登录服务器以后 PATH 变量设置是有效的，可以正常使用 Neovim，这说明 <code>.bash_profile</code> 里面的设置在登录的时候并未被执行。</p><p>原因何在？知道了问题症结以后，很快找到了答案，原来是登录账户时使用的 <code>su $USERNAME</code> 指令的问题。我们的服务器登陆方式比较特殊，并不是通过 SSH 直接登陆到自己目标服务器，而是先 SSH 登陆到一个跳板机，然后以一个统一身份登陆到目标服务器，最后每个用户使用 <code>su $USERNAME</code> 切换到自己的账号。如果使用该指令切换到自己的账户，打开的 shell 是 non-login shell，只有 <code>.bashrc</code> 里面的设置被 source，所以 <code>.bash_profile</code> 里面的设置才没有生效。</p><p>什么是 non-login shell？要说清这个问题，需要先介绍 shell 的不同工作模式，为了简化问题，仅仅针对 Bash。shell 分为 login shell 和 non-login shell；也可以分为 interactive shell 和 non-interactive shell.</p><h1 id=loginnon-login-shell-以及-interactivenon-interactive-shell>login/non-login shell 以及 interactive/non-interactive shell</h1><p>Login shell 一般指的是用户通过正常的 ssh 登录到服务器（输入用户名和密码）进入的 shell；如果进入 login shell 以后，再打开 GUI terminal 或者执行 <code>bash</code> 命令，此时打开的是 non-login shell。</p><p>Interactive shell 指的是 shell 可以输出结果，也可以接受输入；non-interactive shell 则无法接受用户输入，当运行 script 的时候，实际上就是有一个 non-interactive shell 在执行脚本文件。</p><h1 id=哪些配置文件被读取>哪些配置文件被读取？</h1><p>采用 interactive login shell 登录的时候，首先读取并执行 <code>/etc/profile</code> 文件中命令，然后再依次顺序寻找 <code>~/.bash_profile</code>,<code>~/.bash_login</code> 和 <code>~/.profile</code> 文件，然后从第一个存在且可读取的文件中读取并执行指令。Bash 的 man page 说明如下：</p><blockquote><p>When bash is invoked as an <strong>interactive login shell</strong>, or as a non-interactive shell with the &ndash;login option, it first reads and executes commands from the file /etc/profile, if that file exists. After reading that file, it looks for ~/.bash_profile, ~/.bash_login, and ~/.profile, in that order, and reads and executes commands from <strong>the first one that exists and is readable</strong></p></blockquote><p>如果是 interactive non-login shell, 启动时候，首先读取执行 <code>/etc/bashrc</code>，然后再读取执行 <code>~/.bashrc</code>。</p><p>以上两种情况是最常见的。</p><p>使用 <code>su $USERNAME</code> 切换到自己的账号，打开的 Bash shell 实际上就是一个 interactive non-login shell，<code>.bash_profile</code> 里面的内容并没有被执行，所以设置才没有生效。想要在登录账号的时候确保 <code>.bash_profile</code> 里面的配置生效，打开的 shell 必须是 login shell。<code>su</code> 命令提供了 <code>-l</code> 选项（等同于 <code>-</code>）:</p><blockquote><p>-l Simulate a full login. The environment is discarded except for HOME, SHELL, PATH, TERM, and USER. HOME and SHELL are modified as above. USER is set to the target login. PATH is set to <code>/bin:/usr/bin</code>. TERM is imported from your current environment. The invoked shell is the target login&rsquo;s, and su will change directory to the target login&rsquo;s home directory.</p></blockquote><p>简单来说，<code>-l</code> 或 <code>-</code> 保证我们打开的是一个 login shell。所以，登录时候使用 <code>su - USERNAME</code> 即可保证 <code>.bash_profile</code> 里面的设置生效。</p><h1 id=参考>参考</h1><ul><li><a href=https://askubuntu.com/q/121073/768311>Why ~/.bash_profile is not getting sourced when opening a terminal</a>?</li><li><a href=https://unix.stackexchange.com/q/29791/221410>.bash_profile not sourced when running su</a>.</li><li><a href=https://unix.stackexchange.com/q/88106/221410>Why doesn&rsquo;t my ~/.bash_profile work</a>?</li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>jdhao</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2021-01-07</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/shell/>shell</a>
<a href=/tags/Bash/>Bash</a></div><nav class=post-nav><a class=prev href=/2018/09/10/nerdtree_usage/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Intro to Nvim File Explorer Plugin Nerdtree</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/2018/09/05/centos_nvim_install_use_guide/><span class="next-text nav-default">Linux 下 Neovim 配置 Python 开发环境指南</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a><a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a><a href=https://github.com/jdhao class="iconfont icon-github" title=github></a><a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> </span><span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2017 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script><script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script><script>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-113395108-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>