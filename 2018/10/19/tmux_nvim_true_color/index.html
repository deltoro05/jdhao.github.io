<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Setting up True Color Support for Neovim and Tmux on Mac - jdhao's digital space</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="jdhao"><meta name=description content=" Update log 2021-11-23: update tmux and nvim version to the latest and fix other issues.
In this post, I want to share how to set up true color support in Tmux, Nvim and the shell to make them work nicely together.
"><meta name=keywords content="Hugo,theme,even"><meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw"><meta name=generator content="Hugo 0.123.8 with theme even"><link rel=canonical href=https://jdhao.github.io/2018/10/19/tmux_nvim_true_color/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Setting up True Color Support for Neovim and Tmux on Mac"><meta property="og:description" content="
Update log
2021-11-23: update tmux and nvim version to the latest and fix other issues.

In this post, I want to share how to set up true color support in Tmux, Nvim
and the shell to make them work nicely together."><meta property="og:type" content="article"><meta property="og:url" content="https://jdhao.github.io/2018/10/19/tmux_nvim_true_color/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-10-19T01:08:00+08:00"><meta property="article:modified_time" content="2021-11-23T15:16:16+01:00"><meta itemprop=name content="Setting up True Color Support for Neovim and Tmux on Mac"><meta itemprop=description content="
Update log
2021-11-23: update tmux and nvim version to the latest and fix other issues.

In this post, I want to share how to set up true color support in Tmux, Nvim
and the shell to make them work nicely together."><meta itemprop=datePublished content="2018-10-19T01:08:00+08:00"><meta itemprop=dateModified content="2021-11-23T15:16:16+01:00"><meta itemprop=wordCount content="678"><meta itemprop=keywords content="Tmux,Nvim,terminal,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting up True Color Support for Neovim and Tmux on Mac"><meta name=twitter:description content="
Update log
2021-11-23: update tmux and nvim version to the latest and fix other issues.

In this post, I want to share how to set up true color support in Tmux, Nvim
and the shell to make them work nicely together."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>jdhao's digital space</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>jdhao's digital space</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Setting up True Color Support for Neovim and Tmux on Mac</h1><div class=post-meta><span class=post-time>2018-10-19</span><div class=post-category><a href=/categories/Mac/>Mac</a></div><span class=more-meta>678 words </span><span class=more-meta>4 mins read </span><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#version-info>Version info</a></li><li><a href=#setting-up-true-color-support>Setting up true color support</a><ul><li><a href=#terminal-emulator-settings>terminal emulator settings</a><ul><li><a href=#iterm2-settings>iTerm2 settings</a></li><li><a href=#kitty-settings>kitty settings</a></li></ul></li><li><a href=#neovim-settings>Neovim settings</a></li><li><a href=#tmux-settings>Tmux settings</a></li></ul></li><li><a href=#verifying>Verifying</a></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=post-content><details><summary><font size=2 color=red>Update log</font></summary><p><font color=blue>2021-11-23: update tmux and nvim version to the latest and fix other issues.</font></p></details><p>In this post, I want to share how to set up true color support in Tmux, Nvim
and the shell to make them work nicely together.</p><p>There are tons of posts on the Internet regarding how to set up true color
support to make Tmux, Nvim and terminal work together. Time flies and settings
may change. Many people also do not really understand the reason behind all the
settings and often give some ad-hoc settings. All these lead to chaos. It turns
out that setting up true color support is painfully difficult and costs me
several hours.</p><h1 id=version-info>Version info</h1><p>Before we begin, I will list the info about all the necessary components so
that you can reproduce on your device:</p><ul><li>Terminal: <a href=https://github.com/gnachman/iTerm2>iTerm2</a> and <a href=https://github.com/kovidgoyal/kitty>kitty</a>, which support True color by default.</li><li>Tmux: Version 3.2 (<code>tmux -V</code>) and installed via HomeBrew</li><li>Neovim: v0.5.1 (<code>nvim --version</code>) and installed via HomeBrew</li></ul><p>First, we have to understand that not all terminals support true colors. Whether
you use a terminal emulator to connect to remote host or use a native terminal,
make sure that your terminal supports true colors. For a list of terminals
supporting true colors, see <a href=https://github.com/termstandard/colors>this wonderful repo</a>.</p><h1 id=setting-up-true-color-support>Setting up true color support</h1><h2 id=terminal-emulator-settings>terminal emulator settings</h2><h3 id=iterm2-settings>iTerm2 settings</h3><p>For iTerm2, make sure the output of <code>echo $TERM</code> is <code>xterm-256color</code>. If the
output is wrong, you should set it properly in iTerm2. Open the iTerm2
preference settings, go to <code>Profiles --> Terminal</code>, in the <em>Terminal Emulation</em>
part, choose <code>xterm-256color</code> as the reported terminal type.</p><p align=center><img src=https://blog-resource-1257868508.file.myqcloud.com/20200222134641.jpg></p><p><strong>Do not set TERM variable in your shell profile!</strong> It is your terminal
emulator that is responsible for reporting what kind of terminal it supports.
If you set TERM variable in your shell, the TERM variable inside Tmux will also
be set to that value when the shell is initialized, which is simply wrong!<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
<strong>Do not do this.</strong></p><h3 id=kitty-settings>kitty settings</h3><p>Open <code>~/.config/kitty/kitty.conf</code> and use the following setting:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>term xterm-256color
</span></span></code></pre></div><h2 id=neovim-settings>Neovim settings</h2><p>Neovim has good support for true colors. According to <a href=https://github.com/neovim/neovim/wiki/FAQ#how-can-i-use-true-color-in-the-terminal>official doc</a>,
to enable true color support, you need to add the following setting to
<code>init.vim</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=cl><span class=k>set</span> <span class=nx>termguicolors</span>
</span></span></code></pre></div><h2 id=tmux-settings>Tmux settings</h2><p>In order to make Nvim colorscheme work well inside Tmux, you need to add these
settings to your <code>.tmux.conf</code><sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>set -g default-terminal &#34;screen-256color&#34;
</span></span><span class=line><span class=cl># tell Tmux that outside terminal supports true color
</span></span><span class=line><span class=cl>set -ga terminal-overrides &#34;,xterm-256color*:Tc&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># for tmux 3.2, you can use the following setting instead:
</span></span><span class=line><span class=cl># set -as terminal-features &#34;,xterm-256color:RGB&#34;
</span></span></code></pre></div><p>You can also use <code>tmux-256color</code> instead of <code>screen-256color</code>. <code>Tmux-256color</code>
supports italics inside Tmux. In case your system does not have an entry for
<code>tmux-256color</code>, you can download terminfo database and build a more complete
one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -LO http://invisible-island.net/datafiles/current/terminfo.src.gz
</span></span><span class=line><span class=cl>gunzip terminfo.src.gz
</span></span><span class=line><span class=cl>tic -x terminfo.src
</span></span></code></pre></div><p>This will install a terminfo library under your HOME in the directory
<code>.terminfo</code>.</p><h1 id=verifying>Verifying</h1><p>Open up a Tmux session, inside Tmux, the output of <code>echo $TERM</code> should be
<code>screen-256color</code> or <code>tmux-256color</code> depending on which term file you choose to
use, <strong>but the output definitely should not be <code>xterm-256color</code></strong>.</p><p>If you have set up all these properly, run the following command on the command
line:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>awk <span class=s1>&#39;BEGIN{
</span></span></span><span class=line><span class=cl><span class=s1>    s=&#34;/\\/\\/\\/\\/\\&#34;; s=s s s s s s s s;
</span></span></span><span class=line><span class=cl><span class=s1>    for (colnum = 0; colnum&lt;77; colnum++) {
</span></span></span><span class=line><span class=cl><span class=s1>        r = 255-(colnum*255/76);
</span></span></span><span class=line><span class=cl><span class=s1>        g = (colnum*510/76);
</span></span></span><span class=line><span class=cl><span class=s1>        b = (colnum*255/76);
</span></span></span><span class=line><span class=cl><span class=s1>        if (g&gt;255) g = 510-g;
</span></span></span><span class=line><span class=cl><span class=s1>        printf &#34;\033[48;2;%d;%d;%dm&#34;, r,g,b;
</span></span></span><span class=line><span class=cl><span class=s1>        printf &#34;\033[38;2;%d;%d;%dm&#34;, 255-r,255-g,255-b;
</span></span></span><span class=line><span class=cl><span class=s1>        printf &#34;%s\033[0m&#34;, substr(s,colnum+1,1);
</span></span></span><span class=line><span class=cl><span class=s1>    }
</span></span></span><span class=line><span class=cl><span class=s1>    printf &#34;\n&#34;;
</span></span></span><span class=line><span class=cl><span class=s1>}&#39;</span>
</span></span></code></pre></div><p>The above script will print a color band. If something is wrong, the color band
will show obvious gradient between different parts (see image below for an
example).</p><p align=center><img src=https://blog-resource-1257868508.file.myqcloud.com/20181023012639.png></p><p>If everything works well, you should be able to see a smooth color band both
inside and outside Tmux.</p><p align=center><img src=https://blog-resource-1257868508.file.myqcloud.com/20181020165808.png></p><p>Congratulations, you have finally got it right!</p><h1 id=references>References</h1><ul><li><a href=https://github.com/tmux/tmux/wiki/FAQ#how-do-i-use-rgb-colour>https://github.com/tmux/tmux/wiki/FAQ#how-do-i-use-rgb-colour</a></li><li><a href=https://stackoverflow.com/q/15375992/6064933>https://stackoverflow.com/q/15375992/6064933</a></li><li><a href=https://github.com/neovim/neovim/issues/7353#issuecomment-334279343>Good explanation about what <code>terminal-overrides</code> does</a>.</li><li><a href=https://stackoverflow.com/q/41783367/6064933>https://stackoverflow.com/q/41783367/6064933</a></li><li><a href=https://www.reddit.com/r/neovim/comments/825dj7/the_endless_litany_of_tmux_and_nvim_color_problems/>https://www.reddit.com/r/neovim/comments/825dj7/the_endless_litany_of_tmux_and_nvim_color_problems/</a></li><li><a href=https://stackoverflow.com/a/40482330/6064933>Why you should not set TERM inside shell config file</a>.</li><li><a href=https://unix.stackexchange.com/q/139082/221410>You should not set TERM inside shell config file</a>.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>You can find more discussion <a href=https://github.com/tmux/tmux/issues/1205>here</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>If the file <code>.tmux.conf</code> does not exist under your HOME, just create an empty one and start editing it..&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>jdhao</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2021-11-23</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/Tmux/>Tmux</a>
<a href=/tags/Nvim/>Nvim</a>
<a href=/tags/terminal/>terminal</a></div><nav class=post-nav><a class=prev href=/2018/10/20/qiuniu_migrate_to_tencent_cos/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">博客图床从七牛云存储迁移到腾讯云存储</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/2018/10/18/regular_expression_nvim/><span class="next-text nav-default">An Introduction to Lookaround Regular Expression in Neovim/Vim</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a><a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a><a href=https://github.com/jdhao class="iconfont icon-github" title=github></a><a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> </span><span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2017 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script><script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script><script>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-113395108-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>