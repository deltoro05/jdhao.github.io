<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>How to Deploy Fastapi Application with Docker - jdhao's digital space</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="jdhao"><meta name=description content="In post, I want to summarize the complete steps to deploy a demo web service implemented with FastAPI in Docker container.
"><meta name=keywords content="Hugo,theme,even"><meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw"><meta name=generator content="Hugo 0.105.0 with theme even"><link rel=canonical href=https://jdhao.github.io/2023/08/01/fastapi-app-deployment-docker/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="How to Deploy Fastapi Application with Docker"><meta property="og:description" content="In post, I want to summarize the complete steps to deploy a demo web service implemented with FastAPI in Docker container."><meta property="og:type" content="article"><meta property="og:url" content="https://jdhao.github.io/2023/08/01/fastapi-app-deployment-docker/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-08-01T23:02:09+02:00"><meta property="article:modified_time" content="2023-08-01T23:10:11+02:00"><meta itemprop=name content="How to Deploy Fastapi Application with Docker"><meta itemprop=description content="In post, I want to summarize the complete steps to deploy a demo web service implemented with FastAPI in Docker container."><meta itemprop=datePublished content="2023-08-01T23:02:09+02:00"><meta itemprop=dateModified content="2023-08-01T23:10:11+02:00"><meta itemprop=wordCount content="500"><meta itemprop=keywords content="FastAPI,Docker,"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Deploy Fastapi Application with Docker"><meta name=twitter:description content="In post, I want to summarize the complete steps to deploy a demo web service implemented with FastAPI in Docker container."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>jdhao's digital space</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>jdhao's digital space</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>How to Deploy Fastapi Application with Docker</h1><div class=post-meta><span class=post-time>2023-08-01</span><div class=post-category><a href=/categories/Python/>Python</a></div><span class=more-meta>500 words</span>
<span class=more-meta>3 mins read</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#create-the-service>Create the service</a><ul><li><a href=#preparations>Preparations</a></li><li><a href=#build-the-simple-application>Build the simple application</a></li></ul></li><li><a href=#dockerize-the-service>Dockerize the service</a><ul><li><a href=#generate-requirementstxt>Generate requirements.txt</a></li><li><a href=#create-dockerfile>create Dockerfile</a></li><li><a href=#build-docker-image-and-run>Build docker image and run</a></li></ul></li><li><a href=#references>references</a></li></ul></nav></div></div><div class=post-content><p>In post, I want to summarize the complete steps to deploy a demo web service implemented with FastAPI in Docker container.</p><h1 id=create-the-service>Create the service</h1><h2 id=preparations>Preparations</h2><p>First, we can create the simple project and a Python virtual environment:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir fastapi-hello-world
</span></span><span class=line><span class=cl><span class=nb>cd</span> fastapi-hello-world
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># create the virtual environment</span>
</span></span><span class=line><span class=cl>python -m venv venv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># activate the virutal env</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> venv/bin/activate
</span></span></code></pre></div><p>Install all the packages we need for the development:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install fastapi uvicorn
</span></span></code></pre></div><p>FastAPI is the web framework and Uvicorn is used as the web server for handling requests.</p><h2 id=build-the-simple-application>Build the simple application</h2><p>Create a file named <code>application.py</code> (the filename does not matter):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>fastapi</span> <span class=kn>import</span> <span class=n>FastAPI</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>FastAPI</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>greet</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;ok&#34;</span><span class=p>,</span> <span class=s2>&#34;message&#34;</span><span class=p>:</span> <span class=s2>&#34;hello world!&#34;</span><span class=p>}</span>
</span></span></code></pre></div><p>You can run it locally to make sure that it works:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>uvicorn application:app --host 0.0.0.0 --port <span class=m>1234</span>
</span></span></code></pre></div><p>For <code>--host</code> option, we use <code>0.0.0.0</code>, which tells the server to accept connection from anywhere,
not just the localhost.
Without <code>--host 0.0.0.0</code>, you can only request this service using localhost.
This is especially important when we later dockerize the application.
Without the <code>--host</code> option, you can not request this service in your host computer or other network.</p><p>The <code>--port</code> option specifies the port that this service will listen to.
If you do not specify it, the default will be port <code>8000</code>.</p><p>To avoid typing the command, we can create a <code>start_service.sh</code> script to start the service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>uvicorn application:app --host 0.0.0.0 --port 1234
</span></span></code></pre></div><h1 id=dockerize-the-service>Dockerize the service</h1><h2 id=generate-requirementstxt>Generate requirements.txt</h2><p>We need to create a <code>requirements.txt</code> file for the dependencies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip freeze &gt; requirements.txt
</span></span></code></pre></div><h2 id=create-dockerfile>create Dockerfile</h2><p>The Docker file looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>FROM python:3.10-slim
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>WORKDIR /app
</span></span><span class=line><span class=cl>COPY ./requirements.txt /app
</span></span><span class=line><span class=cl>COPY ./ /app
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>RUN pip install --no-cache-dir -r requirements.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>EXPOSE 1234
</span></span><span class=line><span class=cl>CMD [&#34;/bin/bash&#34;, &#34;start_service.sh&#34;]
</span></span></code></pre></div><p>Do not use only <code>EXPOSE</code> to try to expose an internal port, it does not work.
The <a href=https://docs.docker.com/engine/reference/builder/#expose>official doc</a> about <code>EXPOSE</code> is clear on this:</p><blockquote><p>The EXPOSE instruction does not actually publish the port. It functions as a
type of documentation between the person who builds the image and the person
who runs the container, about which ports are intended to be published. To
actually publish the port when running the container, use the -p flag on
docker run to publish and map one or more ports, or the -P flag to publish
all exposed ports and map them to high-order ports.</p></blockquote><p>So we should use <code>-p</code> to map the internal port to port in the host machine.</p><h2 id=build-docker-image-and-run>Build docker image and run</h2><p>To build the image, run:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker build -t fastapi-hello-world .
</span></span><span class=line><span class=cl># for example, docker build -t hello-world .
</span></span></code></pre></div><p>It will build the image based on the Dockerfile.</p><p>To start the web service, we can run the following command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker run -p 1234:1234 --rm --name hello-world fastapi-hello-world
</span></span></code></pre></div><p>Then you can request this service in your browser using <code>http://127.0.0.1:1234</code>.</p><p>The service cannot be stopped by using <code>Ctrl-C</code><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
We can use docker stop to stop the container instead:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker stop hello-world
</span></span></code></pre></div><h1 id=references>references</h1><ul><li><a href="https://www.youtube.com/watch?v=2a5414BsYqw">https://www.youtube.com/watch?v=2a5414BsYqw</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Adding <code>-it</code> option to docker run can also solve this issue, also discussed <a href=https://stackoverflow.com/a/71620897/6064933>here</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>jdhao</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2023-08-01</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/FastAPI/>FastAPI</a>
<a href=/tags/Docker/>Docker</a></div><nav class=post-nav><a class=prev href=/2023/08/24/extract_pdf_macos/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">How to Extract PDF file on macOS</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/2023/07/25/wezterm_icon_missing/><span class="next-text nav-default">Nerdfont Icon Missing after Wezterm Upgrade</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a>
<a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://github.com/jdhao class="iconfont icon-github" title=github></a>
<a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span></span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2017 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-113395108-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>