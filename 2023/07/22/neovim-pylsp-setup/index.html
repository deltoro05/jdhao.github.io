<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Pylsp setup for Neovim in 2023 - jdhao's digital space</title>
<meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=Cache-Control content="no-transform"><meta http-equiv=Cache-Control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="jdhao"><meta name=description content="TL;DR: my config for pylsp can be found here.
In this post, I would like to share my latest setup for Pylsp in Neovim.
"><meta name=keywords content="Hugo,theme,even"><meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw"><meta name=generator content="Hugo 0.123.8 with theme even"><link rel=canonical href=https://jdhao.github.io/2023/07/22/neovim-pylsp-setup/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Pylsp setup for Neovim in 2023"><meta property="og:description" content="TL;DR: my config for pylsp can be found here.
In this post, I would like to share my latest setup for Pylsp in Neovim."><meta property="og:type" content="article"><meta property="og:url" content="https://jdhao.github.io/2023/07/22/neovim-pylsp-setup/"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-07-22T15:02:55+02:00"><meta property="article:modified_time" content="2023-09-29T20:31:57+02:00"><meta itemprop=name content="Pylsp setup for Neovim in 2023"><meta itemprop=description content="TL;DR: my config for pylsp can be found here.
In this post, I would like to share my latest setup for Pylsp in Neovim."><meta itemprop=datePublished content="2023-07-22T15:02:55+02:00"><meta itemprop=dateModified content="2023-09-29T20:31:57+02:00"><meta itemprop=wordCount content="1008"><meta itemprop=keywords content="LSP,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pylsp setup for Neovim in 2023"><meta name=twitter:description content="TL;DR: my config for pylsp can be found here.
In this post, I would like to share my latest setup for Pylsp in Neovim."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>jdhao's digital space</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>jdhao's digital space</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Pylsp setup for Neovim in 2023</h1><div class=post-meta><span class=post-time>2023-07-22</span><div class=post-category><a href=/categories/Nvim/>Nvim</a></div><span class=more-meta>1008 words </span><span class=more-meta>5 mins read </span><span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#installation>Installation</a></li><li><a href=#neovim-lsp-configuration>Neovim lsp configuration</a></li><li><a href=#configuration-pylint-and-black-in-pyprojecttoml>Configuration pylint and black in <code>pyproject.toml</code></a><ul><li><a href=#pyprojecttoml>pyproject.toml</a></li><li><a href=#pylint>Pylint</a></li><li><a href=#black>Black</a></li></ul></li><li><a href=#make-pylsp-work-inside-a-virtual-env>Make Pylsp work inside a virtual env</a><ul><li><a href=#change-pythonpath>Change PYTHONPATH</a></li><li><a href=#change-config-for-individual-tool>Change config for individual tool</a><ul><li><a href=#pylint-1>Pylint</a></li><li><a href=#mypy>mypy</a></li></ul></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=post-content><p>TL;DR: my config for pylsp can be found <a href=https://github.com/jdhao/nvim-config/blob/4d8ef868ad0ef7f6433d91332aa6649186d9a2fb/lua/config/lsp.lua>here</a>.</p><p>In this post, I would like to share my latest setup for Pylsp in Neovim.</p><h1 id=installation>Installation</h1><ul><li>pylsp install: <code>pip install "python-lsp-server[all]"</code></li><li>3rd party plugins:<ul><li><a href=https://github.com/chantera/python-lsp-isort>python-lsp-isort</a>: <code>pip install python-lsp-isort</code></li><li><a href=https://github.com/python-lsp/pylsp-mypy>pylsp-mypy</a>: <code>pip install pylsp-mypy</code></li><li><a href=https://github.com/python-lsp/python-lsp-black>pylsp-black</a>: <code>pip install python-lsp-black</code></li></ul></li></ul><p>I also tried with <a href=https://github.com/python-rope/pylsp-rope>pylsp-rope</a>, but it works like sh*t, so I won&rsquo;t waste my time on it.</p><h1 id=neovim-lsp-configuration>Neovim lsp configuration</h1><p>Use your favorite plugin manager to install nvim-lspconfig.
Here is my configuration for nvim-lsp with the help of <a href=https://github.com/neovim/nvim-lspconfig>nvim-lspconfig</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>lspconfig</span> <span class=o>=</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;lspconfig&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lspconfig.pylsp</span><span class=p>.</span><span class=n>setup</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=n>on_attach</span> <span class=o>=</span> <span class=n>custom_attach</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=n>settings</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>pylsp</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>plugins</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>-- formatter options</span>
</span></span><span class=line><span class=cl>        <span class=n>black</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>autopep8</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>yapf</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>-- linter options</span>
</span></span><span class=line><span class=cl>        <span class=n>pylint</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>executable</span> <span class=o>=</span> <span class=s2>&#34;pylint&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>pyflakes</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>pycodestyle</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>-- type checker</span>
</span></span><span class=line><span class=cl>        <span class=n>pylsp_mypy</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>-- auto-completion options</span>
</span></span><span class=line><span class=cl>        <span class=n>jedi_completion</span> <span class=o>=</span> <span class=p>{</span> <span class=n>fuzzy</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=c1>-- import sorting</span>
</span></span><span class=line><span class=cl>        <span class=n>pyls_isort</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=n>flags</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>debounce_text_changes</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=n>capabilities</span> <span class=o>=</span> <span class=n>capabilities</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note that for some of the plugins, you can pass other configuration to the execute,
but I prefer to control their behavior using in their configuration files, not using nvim-lsp.</p><p>ref:</p><ul><li>python-lsp configuration: <a href=https://github.com/python-lsp/python-lsp-server/blob/develop/CONFIGURATION.md>https://github.com/python-lsp/python-lsp-server/blob/develop/CONFIGURATION.md</a></li></ul><h1 id=configuration-pylint-and-black-in-pyprojecttoml>Configuration pylint and black in <code>pyproject.toml</code></h1><h2 id=pyprojecttoml>pyproject.toml</h2><p>For project-specific settings, it is convenient to configure all this in the file <code>pyproject.toml</code>.</p><p>Ref:</p><ul><li>learn toml: <a href=https://learnxinyminutes.com/docs/toml/>https://learnxinyminutes.com/docs/toml/</a></li></ul><h2 id=pylint>Pylint</h2><p>Pylint recognizes configurations in <code>pyproject.toml</code> file.
However, configuring pylint in <code>pyproject.toml</code> requires a bit understanding.
First, we can generate a full pylint configuration for later reference:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pylint --generate-rcfile &gt; pylintrc
</span></span></code></pre></div><p>We can see that pylint configuration is separated into multiple sections (or <code>table</code> by TOML&rsquo;s jargon).
When we want to configure a certain option for Pylint, we must know its table in pylintrc.
For example, suppose we want to set <code>max-line-length</code> to 100, first check which table it belongs to in the original pylintrc.
After checking, we know it belongs to <code>FORMAT</code> table, then we can use either two confs in <code>pyproject.toml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>pylint</span><span class=p>.</span><span class=nx>format</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>max-line-length</span> <span class=p>=</span> <span class=mi>100</span>
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>pylint</span><span class=p>.</span><span class=s1>&#39;FORMAT&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>max-line-length</span> <span class=p>=</span> <span class=mi>100</span>
</span></span></code></pre></div><p>Note that for values which are a list, we must use a list notation in <code>pyproject.toml</code>.
For example, if we want to disable both <code>missing-module-docstring</code> and <code>missing-function-docstring</code>,
we can write the config as this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>pylint</span><span class=p>.</span><span class=s1>&#39;MESSAGES CONTROL&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>disable</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;missing-module-docstring&#34;</span><span class=p>,</span> <span class=s2>&#34;missing-function-docstring&#34;</span><span class=p>]</span>
</span></span></code></pre></div><p>The following also works:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>pylint</span><span class=p>.</span><span class=nx>messages_control</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>disable</span> <span class=p>=</span> <span class=p>[</span><span class=s2>&#34;missing-module-docstring&#34;</span><span class=p>,</span> <span class=s2>&#34;missing-function-docstring&#34;</span><span class=p>]</span>
</span></span></code></pre></div><p>In this case, the syntax is <strong>not the same</strong> as pylintrc, where you only need to separated the warnings with comma.</p><p>As another way, we can also use <code>pylint --generate-toml-config</code> to generate a copy of pylintrc options in toml format.
This would be much easier for hand-picking the options that we want to change.</p><p>There are a lot of examples on using pylint in <code>pyproject.toml</code> in GitHub,
e.g., in <a href=https://github.com/aiidateam/aiida-quantumespresso/blob/5d4a7d9405b757e2ecf65a72c1ee92aa2fb36a39/pyproject.toml#L156-L192>AiiDA</a>, <a href=https://github.com/google/jax/blob/1b33a4eb05b9d471368e525c2f798859986d6096/pyproject.toml#L80-L102>jax</a>, <a href=https://github.com/pylint-dev/pylint/blob/c4281bcff86b66fdf8518e7f57dc3405c8da3a4f/examples/pyproject.toml#L354>example conf from pylint offical</a>.</p><p>ref:</p><ul><li>pylint&rsquo;s support for pyproject.toml: <a href=https://pylint.pycqa.org/en/latest/user_guide/usage/run.html#command-line-options>https://pylint.pycqa.org/en/latest/user_guide/usage/run.html#command-line-options</a></li><li>handle rich types in TOML: <a href=https://github.com/pylint-dev/pylint/commit/489508cc68705cf07e9fea8acd2b449ea88aa962>https://github.com/pylint-dev/pylint/commit/489508cc68705cf07e9fea8acd2b449ea88aa962</a></li><li>how to decide what option belongs to which section: <a href=https://github.com/pylint-dev/pylint/issues/3181#issuecomment-846129966>https://github.com/pylint-dev/pylint/issues/3181#issuecomment-846129966</a></li><li>search pylint config in setup.cfg and pyproject.toml: <a href=https://github.com/pylint-dev/pylint/issues/617#issuecomment-541474172>https://github.com/pylint-dev/pylint/issues/617#issuecomment-541474172</a></li></ul><h2 id=black>Black</h2><p>Configuration can be inside <code>pyproject.toml</code>, the section of black is <code>[tool.black]</code>.
For example, your configuration may look like the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>tool</span><span class=p>.</span><span class=nx>black</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>line-length</span> <span class=p>=</span> <span class=mi>100</span>
</span></span></code></pre></div><p>You can also check how the black project configures itself <a href=https://github.com/psf/black/blob/0b301f80954a026693c4c22de89267ad8c85f9b6/pyproject.toml#L8-L22>here</a>.</p><p>ref:</p><ul><li><a href=https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#what-on-earth-is-a-pyproject-toml-file>https://black.readthedocs.io/en/stable/usage_and_configuration/the_basics.html#what-on-earth-is-a-pyproject-toml-file</a></li></ul><h1 id=make-pylsp-work-inside-a-virtual-env>Make Pylsp work inside a virtual env</h1><p>In my computer, pylsp, mypy, black, pylint and isort are all installed globally.
I do not want to install all of these tools separately for each virtual env I use.
For black and isort, they seem to work fine without any additional settings.</p><p>For Pylsp, there seem to be not much mature solution<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.
I experimented with different configuration and find what is working for me.</p><h2 id=change-pythonpath>Change PYTHONPATH</h2><p>We can also update the <code>PYTHONPATH</code> variable to make the global pylint and mypy be aware of the packages installed inside the virtual environment.
That is we can set variable to the package directory for the virtual environment:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PYTHONPATH</span><span class=o>=</span><span class=nv>$PYTHONPATH</span>:/path/to/project/venv/lib/&lt;python-version&gt;/site-packages
</span></span></code></pre></div><p>After this setup, pylint and mypy seem to work fine.</p><p>ref:</p><p><a href=https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPATH>https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPATH</a></p><h2 id=change-config-for-individual-tool>Change config for individual tool</h2><h3 id=pylint-1>Pylint</h3><p>For pylint installed globally, it can not recognize the packages installed inside the virtual environment,
even if we are inside the virtual env.
First, we can install <a href=https://github.com/jgosmann/pylint-venv/>pylint-venv</a> in the global level (outside the virtual env):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pip install pylint-venv
</span></span></code></pre></div><p>Then inside the <code>pyproject.toml</code> file for this project, we can configure a init-hook for pylint:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=k>tool</span><span class=o>.</span><span class=n>pylint</span><span class=o>.</span><span class=n>main</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>init</span><span class=o>-</span><span class=n>hook</span> <span class=o>=</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>try:
</span></span></span><span class=line><span class=cl><span class=s2>  import pylint_venv
</span></span></span><span class=line><span class=cl><span class=s2>except ImportError:
</span></span></span><span class=line><span class=cl><span class=s2>  pass
</span></span></span><span class=line><span class=cl><span class=s2>else:
</span></span></span><span class=line><span class=cl><span class=s2>  pylint_venv.inithook()
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>This seems to work pretty good to prevent pylint from complaining missing package errors.</p><h3 id=mypy>mypy</h3><p>To use global mypy, we need to instruct mypy the python path inside the virtual environment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=k>tool</span><span class=o>.</span><span class=n>mypy</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>python_executable</span><span class=o>=</span><span class=s2>&#34;../venv/bin/python&#34;</span>
</span></span></code></pre></div><p>Another way to do this is to directly change the options passed to mypy in neovim-lsp configuration:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>venv_path</span> <span class=o>=</span> <span class=n>os.getenv</span><span class=p>(</span><span class=s1>&#39;VIRTUAL_ENV&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=kd>local</span> <span class=n>py_path</span> <span class=o>=</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>  <span class=c1>-- decide which python executable to use for mypy</span>
</span></span><span class=line><span class=cl>  <span class=kr>if</span> <span class=n>venv_path</span> <span class=o>~=</span> <span class=kc>nil</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>    <span class=n>py_path</span> <span class=o>=</span> <span class=n>venv_path</span> <span class=o>..</span> <span class=s2>&#34;/bin/python3&#34;</span>
</span></span><span class=line><span class=cl>  <span class=kr>else</span>
</span></span><span class=line><span class=cl>    <span class=n>py_path</span> <span class=o>=</span> <span class=n>vim.g</span><span class=p>.</span><span class=n>python3_host_prog</span>
</span></span><span class=line><span class=cl>  <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>lspconfig.pylsp</span><span class=p>.</span><span class=n>setup</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>on_attach</span> <span class=o>=</span> <span class=n>custom_attach</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>settings</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>pylsp</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>plugins</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=c1>-- formatter options</span>
</span></span><span class=line><span class=cl>          <span class=n>black</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=n>autopep8</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=n>yapf</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=c1>-- linter options</span>
</span></span><span class=line><span class=cl>          <span class=n>pylint</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>executable</span> <span class=o>=</span> <span class=s2>&#34;pylint&#34;</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=n>ruff</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=n>pyflakes</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=n>pycodestyle</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=c1>-- type checker</span>
</span></span><span class=line><span class=cl>          <span class=n>pylsp_mypy</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>overrides</span> <span class=o>=</span> <span class=p>{</span> <span class=s2>&#34;--python-executable&#34;</span><span class=p>,</span> <span class=n>py_path</span><span class=p>,</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>report_progress</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>live_mode</span> <span class=o>=</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>          <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=c1>-- auto-completion options</span>
</span></span><span class=line><span class=cl>          <span class=n>jedi_completion</span> <span class=o>=</span> <span class=p>{</span> <span class=n>fuzzy</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>          <span class=c1>-- import sorting</span>
</span></span><span class=line><span class=cl>          <span class=n>isort</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enabled</span> <span class=o>=</span> <span class=kc>true</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>flags</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>debounce_text_changes</span> <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>capabilities</span> <span class=o>=</span> <span class=n>capabilities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>ref:</p><ul><li>mypy and pyproject.toml: <a href=https://mypy.readthedocs.io/en/stable/config_file.html#using-a-pyproject-toml-file>https://mypy.readthedocs.io/en/stable/config_file.html#using-a-pyproject-toml-file</a></li><li>mypy and virtual env: <a href=https://github.com/python/mypy/issues/7360#issuecomment-522255927>https://github.com/python/mypy/issues/7360#issuecomment-522255927</a></li><li>pylsp-mypy configuration: <a href=https://github.com/python-lsp/pylsp-mypy#configuration>https://github.com/python-lsp/pylsp-mypy#configuration</a></li></ul><h1 id=references>References</h1><ul><li>install language server globally or in virtual env: <a href=https://www.reddit.com/r/emacs/comments/13ezfq9/python_do_you_install_the_language_server/>https://www.reddit.com/r/emacs/comments/13ezfq9/python_do_you_install_the_language_server/</a></li><li><a href=https://www.reddit.com/r/neovim/comments/137u0z8/general_python_lspcompletion_advice/>https://www.reddit.com/r/neovim/comments/137u0z8/general_python_lspcompletion_advice/</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>For pyright, there seems to be a simple solution using <code>pyrightconfig.json</code>, as discussed <a href=https://stackoverflow.com/a/66559305/6064933>here</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>jdhao</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2023-09-29</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/LSP/>LSP</a></div><nav class=post-nav><a class=prev href=/2023/07/25/wezterm_icon_missing/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Nerdfont Icon Missing after Wezterm Upgrade</span>
<span class="prev-text nav-mobile">Prev</span>
</a><a class=next href=/2023/07/13/fastapi-query-param-with-multiple-value/><span class="next-text nav-default">How to Parse Query Param With Multiple Values in FastAPI</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a><a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a><a href=https://github.com/jdhao class="iconfont icon-github" title=github></a><a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a>
</span><span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> </span><span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2017 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script><script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script><script>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-113395108-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>