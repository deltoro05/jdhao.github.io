<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Why don't settings inside bashrc or bash_profile take effect? - jdhao's digital space</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="jdhao"><meta name=description content="In this post, I would like to share causes and solutions to a few issues related to login shell.
"><meta name=keywords content="Hugo,theme,even"><meta name=google-site-verification content="HTz0VHxqny_b0FfS774dICLBzHGBZCb_S11j_akF1Tw"><meta name=generator content="Hugo 0.105.0 with theme even"><link rel=canonical href=https://jdhao.github.io/2019/09/29/linux_login_setup/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-6058871559165202",enable_page_level_ads:!0})</script><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Why don't settings inside bashrc or bash_profile take effect?"><meta property="og:description" content="In this post, I would like to share causes and solutions to a few issues
related to login shell."><meta property="og:type" content="article"><meta property="og:url" content="https://jdhao.github.io/2019/09/29/linux_login_setup/"><meta property="article:section" content="post"><meta property="article:published_time" content="2019-09-29T21:40:28+08:00"><meta property="article:modified_time" content="2021-01-07T16:32:27+01:00"><meta itemprop=name content="Why don't settings inside bashrc or bash_profile take effect?"><meta itemprop=description content="In this post, I would like to share causes and solutions to a few issues
related to login shell."><meta itemprop=datePublished content="2019-09-29T21:40:28+08:00"><meta itemprop=dateModified content="2021-01-07T16:32:27+01:00"><meta itemprop=wordCount content="998"><meta itemprop=keywords content="shell,Bash,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Why don't settings inside bashrc or bash_profile take effect?"><meta name=twitter:description content="In this post, I would like to share causes and solutions to a few issues
related to login shell."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>jdhao's digital space</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>jdhao's digital space</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Why don't settings inside bashrc or bash_profile take effect?</h1><div class=post-meta><span class=post-time>2019-09-29</span><div class=post-category><a href=/categories/Linux/>Linux</a></div><span class=more-meta>998 words</span>
<span class=more-meta>5 mins read</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> times read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#how-to-change-default-shell-to-bash>How to change default shell to Bash</a></li><li><a href=#settings-in-bashrc-or-bash_profile-do-not-take-effect-after-login>Settings in <code>bashrc</code> or <code>bash_profile</code> do not take effect after login</a><ul><li><a href=#login-and-interactive-shell>Login and interactive shell</a><ul><li><a href=#login-shell>login shell</a></li><li><a href=#interactive-shell>Interactive shell</a></li><li><a href=#different-types-of-shell>Different types of shell</a></li></ul></li><li><a href=#why-isnt-bashrc-sourced>Why isn&rsquo;t <code>.bashrc</code> sourced?</a></li><li><a href=#why-isnt-bash_profile-sourced>Why isn&rsquo;t <code>.bash_profile</code> sourced?</a></li><li><a href=#what-gets-sourced-when-we-run-a-non-interactive-non-login-shell>What gets sourced when we run a non-interactive non-login shell?</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=post-content><p>In this post, I would like to share causes and solutions to a few issues
related to login shell.</p><h1 id=how-to-change-default-shell-to-bash>How to change default shell to Bash</h1><p>When I logged into a new server, I found that somehow my default shell (<code>echo $SHELL</code>) is <code>/bin/sh</code> instead of <code>/bin/bash</code>. We can change the default shell
with <code>chsh</code> command like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chsh -s /bin/bash
</span></span></code></pre></div><p>Make sure that the shell you want to switch are set in <code>/etc/shells</code>. Otherwise
you will fail.</p><h1 id=settings-in-bashrc-or-bash_profile-do-not-take-effect-after-login>Settings in <code>bashrc</code> or <code>bash_profile</code> do not take effect after login</h1><p>Another issue is that when I sshed to the server, I found that only settings
inside <code>.bash_profile</code> is sourced. Settings inside <code>.bashrc</code> didn&rsquo;t take
effect. Before we delve into this problem, we first need to understand the
basic concept of a login shell and an interactive shell.</p><h2 id=login-and-interactive-shell>Login and interactive shell</h2><h3 id=login-shell>login shell</h3><p>A login shell is usually the shell when the user first log in to the
system. If the user start another shell or use <code>bash</code> inside the current
shell, then the user will probably start a non-login shell<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. To
check whether the bash shell is a login shell, use the following
command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># only works for bash</span>
</span></span><span class=line><span class=cl><span class=nb>shopt</span> -q login_shell <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s1>&#39;Login shell&#39;</span> <span class=o>||</span> <span class=nb>echo</span> <span class=s1>&#39;Not login shell&#39;</span>
</span></span></code></pre></div><h3 id=interactive-shell>Interactive shell</h3><p>Roughly speaking, an interactive shell is a shell that the user can interact
with via the terminal, i.e., typing a command, sending it to the shell and
getting output. If you run a script <code>test.sh</code> inside the shell by using <code>bash test.sh</code>, what actually happens is that a non-interactive bash shell is started
to execute the commands inside <code>test.sh</code>. Now, you get a sense of what
<em>interactive</em> means. To check if a bash shell is interactive, you can see if
<code>i</code> is present in the variable <code>$-</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$-</span>
</span></span><span class=line><span class=cl><span class=c1># output may be: himBHs</span>
</span></span></code></pre></div><h3 id=different-types-of-shell>Different types of shell</h3><p>According to the above statements, we now have four different types of a shell:</p><ul><li>interactive login shell</li><li>interactive non-login shell</li><li>non-interactive login shell</li><li>non-interactive non-login shell</li></ul><p>In the following table, I show how you can get these shells:</p><table><thead><tr><th></th><th>interactive</th><th>non-interactive</th></tr></thead><tbody><tr><td>login</td><td>when you log into a server normally</td><td><code>ssh xxx@ip &lt; test.sh</code></td></tr><tr><td>non-login</td><td>start a new bash shell inside the login shell</td><td>when you execute script inside the login shell</td></tr></tbody></table><p>Non-interactive login shell is extremely rare. You can start one when
you <a href=https://stackoverflow.com/q/40853547/6064933>run a local script via ssh on remote.</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh xxx@ip &lt; test.sh
</span></span></code></pre></div><p>To verify that we have started a non-interactive login shell, put the
following the command inside <code>test.sh</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$-</span>
</span></span><span class=line><span class=cl><span class=nb>shopt</span> -q login_shell <span class=o>&amp;&amp;</span> <span class=nb>echo</span> <span class=s1>&#39;Login shell&#39;</span> <span class=o>||</span> <span class=nb>echo</span> <span class=s1>&#39;Not login shell&#39;</span>
</span></span></code></pre></div><p>The output of remote server will be:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hBs
</span></span><span class=line><span class=cl>Login shell
</span></span></code></pre></div><h2 id=why-isnt-bashrc-sourced>Why isn&rsquo;t <code>.bashrc</code> sourced?</h2><p>After looking up the bash manual, the section on <a href=https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Bash-Startup-Files>startup file</a>
explains this behaviour:</p><blockquote><p>When Bash is invoked as an interactive login shell, or as a
non-interactive shell with the –login option, it first reads and
executes commands from the file /etc/profile, if that file exists.
After reading that file, it looks for ~/.bash_profile,
~/.bash_login, and ~/.profile, in that order, and reads and
executes commands from the first one that exists and is readable. The
–noprofile option may be used when the shell is started to inhibit
this behavior.</p></blockquote><p>According to the above description, when you log into the server (bash is
interactive login shell), bash will first source <code>/etc/profile</code>, then it will
source <code>~/.bash_profile</code>, <code>~/.bash_login</code> and <code>~/.profile</code> in the order given.
The first one that exists and is readable is sourced. So <code>~/.bashrc</code> is not
sourced during the login process.</p><p>If you need to source <code>.bashrc</code> during login process, you can add the
following setting to <code>.bash_profile</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -f <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.bashrc&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>source</span> <span class=nv>$HOME</span>/.bashrc
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><h2 id=why-isnt-bash_profile-sourced>Why isn&rsquo;t <code>.bash_profile</code> sourced?</h2><p>Another strange case I met with a new server is that <code>~/.bash_profile</code> is not
executed during login. A little background here: for this destination server, I
need to log into a <a href=https://en.wikipedia.org/wiki/Jump_server>jump server</a>,
and choose the destination server. All users are initially logged in to the
destination server with the same user name. Then each user will have to switch
to his/her own account via <code>su</code> command: <code>su REAL_USERNAME</code>.</p><p>That is cause of the problem. The shell started by mere <code>su REAL_USERNAME</code> is
an interactive <strong>non-login</strong> shell. The bash manual also says that:</p><blockquote><p>When an interactive shell that is not a login shell is started, Bash
reads and executes commands from ~/.bashrc, if that file exists. This
may be inhibited by using the –norc option. The –rcfile file option
will force Bash to read and execute commands from file instead of
~/.bashrc.</p></blockquote><p>It means that only settings inside <code>$HOME/.bashrc</code> is sourced. The solution to
this issue is simple: <a href=https://unix.stackexchange.com/q/7013/221410>invoke <code>su</code> command with <code>-</code> or <code>-l</code> option</a>
to tell Bash that we want a login shell instead of a non-login shell.</p><h2 id=what-gets-sourced-when-we-run-a-non-interactive-non-login-shell>What gets sourced when we run a non-interactive non-login shell?</h2><p>The Bash manual says that for a non-interactive shell, it has the following behavior:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>When bash is started non-interactively, to run a shell script, for example, it looks for the variable BASH_ENV
</span></span><span class=line><span class=cl>in  the  environment, expands its value if it appears there, and uses the expanded value as the name of a file
</span></span><span class=line><span class=cl>to read and execute.  Bash behaves as if the following command were executed:
</span></span><span class=line><span class=cl>       if [ -n &#34;$BASH_ENV&#34; ]; then . &#34;$BASH_ENV&#34;; fi
</span></span><span class=line><span class=cl>but the value of the PATH variable is not used to search for the filename.
</span></span></code></pre></div><p>So only the file represented by <code>BASH_ENV</code> is sourced when a non-interactive
shell is started.</p><h1 id=references>References</h1><ul><li><a href=https://blog.flowblok.id.au/2013-02/shell-startup-scripts.html>This post has good graph on what is sourced during bash startup</a>.</li><li><a href=https://askubuntu.com/q/596538/768311>Bashrc isn’t always run when I log in</a>.</li><li><a href=https://unix.stackexchange.com/q/271858/221410>Change shell in Ubuntu</a>.</li><li><a href=https://unix.stackexchange.com/a/398105/221410>How to get non-interactive login shell</a>.</li><li><a href=https://unix.stackexchange.com/q/26676/221410>How to check if a shell’s type: login or interactive</a>.</li><li><a href=https://askubuntu.com/q/879364/768311>Difference between login, non-login, interactive and non-interactive shells</a>.</li><li><a href=http://zsh.sourceforge.net/Guide/zshguide02.html#l7>Zsh doc on login and interactive shells</a>.</li><li><a href=https://superuser.com/q/183870/736190>Difference between bashrc and bash_profile</a>.</li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>That is not always true. For example, for macOS, new terminal started by Terminal.app is actually a login shell, see <a href=https://unix.stackexchange.com/q/119627/221410>here</a>.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>jdhao</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2021-01-07</span></p><p class=copyright-item><span class=item-title>License</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/shell/>shell</a>
<a href=/tags/Bash/>Bash</a></div><nav class=post-nav><a class=prev href=/2019/10/01/zplug_install_docker_container/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">How to Install zplug inside Docker Container</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/2019/09/27/linux_locale_settings/><span class="next-text nav-default">Setting Up Locale in Linux</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=jdhao/jdhao.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:jdhao@hotmail.com class="iconfont icon-email" title=email></a>
<a href="https://stackoverflow.com/users/6064933/jdhao?tab=profile" class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://github.com/jdhao class="iconfont icon-github" title=github></a>
<a href=https://jdhao.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>site pv: <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span></span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>site uv: <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span></span></div><span class=copyright-year>&copy;
2017 -
2024<span class=heart><i class="iconfont icon-heart"></i></span><span>jdhao</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-113395108-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>